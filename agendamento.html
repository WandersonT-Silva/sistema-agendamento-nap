<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Agendamento - Sistema NAP</title>
    <style>
        /* ===== TEMA ESCOLA - SANTO ANTÔNIO ===== */
        :root {
            --dourado: #D4AF37;
            --laranja: #FF6B35;
            --azul-marinho: #1E3A8A;
            --branco: #FFFFFF;
            --cinza-claro: #F8FAFC;
            --cinza-medio: #6B7280;
            --cinza-escuro: #1F2937;
            --verde: #16A34A;
            --vermelho: #DC2626;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--cinza-claro) 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--cinza-escuro);
        }

        /* ===== CABEÇALHO SIMPLIFICADO ===== */
        .header {
            position: relative;
            height: 80px;
            background: var(--azul-marinho);
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
        }

        .header-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--azul-marinho);
            z-index: 1;
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 30px;
            height: 100%;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            height: 50px;
            width: auto;
            filter: brightness(0) invert(1);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* ===== MENU LATERAL ===== */
        .sidebar {
            width: 90px;
            background: var(--branco);
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        .menu-nav {
            list-style: none;
            padding: 20px 0;
            flex: 1;
        }

        .menu-item {
            position: relative;
            padding: 18px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            margin: 5px 0;
        }

        .menu-item:hover {
            background: var(--cinza-claro);
            border-left-color: var(--laranja);
        }

        .menu-item.active {
            background: var(--azul-marinho);
            border-left-color: var(--dourado);
        }

        .menu-item.active .menu-icon {
            color: var(--branco);
            transform: scale(1.1);
        }

        .menu-item.active .menu-text {
            color: var(--branco);
            font-weight: 600;
        }

        .menu-icon {
            font-size: 22px;
            display: block;
            margin-bottom: 6px;
            color: var(--cinza-medio);
            transition: all 0.3s ease;
        }

        .menu-text {
            font-size: 11px;
            color: var(--cinza-medio);
            font-weight: 500;
            line-height: 1.2;
        }

        .menu-tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: var(--azul-marinho);
            color: var(--branco);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-left: 15px;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
            border: 1px solid var(--dourado);
        }

        .menu-tooltip::before {
            content: '';
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: var(--azul-marinho);
        }

        .menu-item:hover .menu-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* ===== CONTEÚDO PRINCIPAL ===== */
        .content {
            flex: 1;
            padding: 30px;
            background: var(--cinza-claro);
            display: flex;
            gap: 30px;
            overflow-y: auto;
        }

        /* ===== PAINEL ESQUERDO ===== */
        .left-panel {
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .agendamento-selecionado {
            background: var(--branco);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--dourado);
        }

        .agendamento-selecionado h3 {
            color: var(--azul-marinho);
            font-size: 16px;
            font-weight: 600;
        }

        .actions-panel {
            background: var(--branco);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .agendamentos-list {
            flex: 1;
            background: var(--branco);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .agendamentos-list h3 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .gallery {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .agendamento-item {
            background: var(--cinza-claro);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .agendamento-item:hover {
            border-color: var(--laranja);
            transform: translateY(-2px);
        }

        .agendamento-item.selected {
            border-color: var(--azul-marinho);
            background: rgba(30, 58, 138, 0.05);
        }

        .agendamento-disciplina {
            font-weight: 600;
            color: var(--azul-marinho);
            margin-bottom: 5px;
        }

        .agendamento-segmento {
            color: var(--cinza-medio);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .agendamento-data {
            color: var(--cinza-escuro);
            font-size: 13px;
            margin-bottom: 5px;
        }

        .agendamento-observacoes {
            color: var(--cinza-medio);
            font-size: 12px;
            font-style: italic;
        }

        .sem-agendamentos {
            text-align: center;
            color: var(--cinza-medio);
            font-style: italic;
            padding: 40px 20px;
        }

        /* ===== PAINEL DIREITO ===== */
        .right-panel {
            flex: 1;
            background: var(--branco);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--dourado);
        }

        .agendamento-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--azul-marinho);
            font-size: 14px;
        }

        .form-group label.required::after {
            content: ' *';
            color: var(--vermelho);
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: var(--branco);
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--azul-marinho);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-group select:disabled {
            background: #f9fafb;
            color: var(--cinza-medio);
            cursor: not-allowed;
        }

        .datetime-group .datetime-inputs {
            display: flex;
            gap: 15px;
        }

        .datetime-group input,
        .datetime-group select {
            flex: 1;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        /* ===== BOTÕES ===== */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-agendar,
        .btn-limpar,
        .btn-excluir {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-agendar {
            background: linear-gradient(135deg, var(--laranja) 0%, var(--dourado) 100%);
            color: var(--branco);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-agendar:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-agendar:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-limpar {
            background: var(--cinza-claro);
            color: var(--cinza-escuro);
            border: 2px solid var(--cinza-medio);
        }

        .btn-limpar:hover {
            background: var(--cinza-medio);
            color: var(--branco);
        }

        .btn-excluir {
            background: var(--vermelho);
            color: var(--branco);
            width: 100%;
            justify-content: center;
        }

        .btn-excluir:hover:not(:disabled) {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        .btn-excluir:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-icon {
            font-size: 16px;
        }

        /* ===== LOADER ===== */
        .loader {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--branco);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 3px solid var(--dourado);
            max-width: 400px;
            width: 90%;
        }

        .modal-content h3 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 24px;
        }

        .modal-content p {
            color: var(--cinza-escuro);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .btn-ok {
            background: var(--azul-marinho);
            color: var(--branco);
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .btn-ok:hover {
            background: #1e40af;
            transform: translateY(-2px);
        }

        /* ===== RESPONSIVO ===== */
        @media (max-width: 1024px) {
            .content {
                flex-direction: column;
            }
            
            .left-panel {
                width: 100%;
                order: 2;
            }
            
            .right-panel {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
            }
            
            .menu-nav {
                display: flex;
                justify-content: space-around;
                padding: 10px 0;
                width: 100%;
            }
            
            .menu-item {
                padding: 10px 5px;
                border-left: none;
                border-bottom: 3px solid transparent;
                flex: 1;
            }
            
            .menu-item.active {
                border-left: none;
                border-bottom-color: var(--dourado);
            }
            
            .menu-tooltip {
                display: none;
            }
            
            .content {
                padding: 20px;
            }
            
            .datetime-group .datetime-inputs {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="agendamento-container">
        <!-- Cabeçalho Simplificado -->
        <header class="header">
            <div class="header-background"></div>
            <div class="header-content">
                <div class="logo-container">
                    <img src="logo-santo-antonio.png" alt="Colégio Santo Antônio" class="logo">
                </div>
            </div>
        </header>

        <!-- Layout Principal -->
        <div class="main-layout">
            <!-- Menu Lateral SEM Logo -->
            <nav class="sidebar">
                <ul class="menu-nav">
                    <li class="menu-item" data-menu="1">
                        <span class="menu-icon">🏠</span>
                        <span class="menu-text">Início</span>
                        <span class="menu-tooltip">Página inicial</span>
                    </li>
                    <li class="menu-item active" data-menu="2">
                        <span class="menu-icon">📅</span>
                        <span class="menu-text">Agendar</span>
                        <span class="menu-tooltip">Novo agendamento</span>
                    </li>
                    <li class="menu-item" data-menu="3">
                        <span class="menu-icon">✉️</span>
                        <span class="menu-text">Suporte</span>
                        <span class="menu-tooltip">Contato e suporte</span>
                    </li>
                    <li class="menu-item" data-menu="4">
                        <span class="menu-icon">📆</span>
                        <span class="menu-text">Calendário</span>
                        <span class="menu-tooltip">Visualizar calendário</span>
                    </li>
                    <li class="menu-item" data-menu="5">
                        <span class="menu-icon">🔍</span>
                        <span class="menu-text">Buscar</span>
                        <span class="menu-tooltip">Busca por alunos</span>
                    </li>
                </ul>
            </nav>

            <!-- Conteúdo Principal -->
            <main class="content">
                <!-- Painel Esquerdo - Meus Agendamentos -->
                <div class="left-panel">
                    <div class="agendamento-selecionado">
                        <h3 id="selected-label">Nada selecionado</h3>
                    </div>
                    
                    <div class="actions-panel">
                        <button id="btn-excluir" class="btn-excluir" disabled>
                            <span class="btn-icon">🗑️</span>
                            EXCLUIR
                        </button>
                    </div>

                    <div class="agendamentos-list">
                        <h3>Meus Agendamentos</h3>
                        <div id="gallery-agendamentos" class="gallery">
                            <!-- Agendamentos serão carregados aqui via JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Painel Direito - Formulário -->
                <div class="right-panel">
                    <form id="form-agendamento" class="agendamento-form">
                        <!-- Disciplina -->
                        <div class="form-group">
                            <label for="disciplina" class="required">Disciplina</label>
                            <select id="disciplina" name="disciplina" required>
                                <option value="">Selecione uma disciplina</option>
                                <option value="Matemática">Matemática</option>
                                <option value="Língua Portuguesa">Língua Portuguesa</option>
                                <option value="História">História</option>
                                <option value="Geografia">Geografia</option>
                                <option value="Ciências">Ciências</option>
                                <option value="Artes">Artes</option>
                                <option value="Língua Inglesa">Língua Inglesa</option>
                                <option value="Química">Química</option>
                                <option value="Educação Física">Educação Física</option>
                                <option value="Biologia">Biologia</option>
                                <option value="Literatura">Literatura</option>
                                <option value="Gramática">Gramática</option>
                                <option value="Filosofia">Filosofia</option>
                                <option value="Sociologia">Sociologia</option>
                                <option value="Oficina de Texto">Oficina de Texto</option>
                                <option value="Raciocínio Lógico">Raciocínio Lógico</option>
                                <option value="Música">Música</option>
                                <option value="Condicionamento Físico no Esporte">Condicionamento Físico no Esporte</option>
                                <option value="Programação para Arduíno">Programação para Arduíno</option>
                                <option value="Cultura Digital">Cultura Digital</option>
                                <option value="Educação Financeira">Educação Financeira</option>
                                <option value="Sistemas para Internet">Sistemas para Internet</option>
                                <option value="Processos Criativos">Processos Criativos</option>
                                <option value="Psicologia e a Saúde Mental">Psicologia e a Saúde Mental</option>
                            </select>
                        </div>

                        <!-- Segmento -->
                        <div class="form-group">
                            <label for="segmento" class="required">Segmento</label>
                            <select id="segmento" name="segmento" required>
                                <option value="">Selecione o segmento</option>
                                <option value="Fundamental 1">Fundamental 1</option>
                                <option value="Fundamental 2">Fundamental 2</option>
                                <option value="Ensino Médio">Ensino Médio</option>
                            </select>
                        </div>

                        <!-- Turma/Série -->
                        <div class="form-group">
                            <label for="turma" class="required">Turma/Série</label>
                            <select id="turma" name="turma" required>
                                <option value="">Selecione a turma</option>
                                <!-- Turmas serão carregadas dinamicamente -->
                            </select>
                        </div>

                        <!-- Data/Hora -->
                        <div class="form-group datetime-group">
                            <label for="data" class="required">Período</label>
                            <div class="datetime-inputs">
                                <input type="date" id="data" name="data" required min="">
                                <select id="hora" name="hora" required disabled>
                                    <option value="">Selecione o horário</option>
                                    <!-- Horários serão carregados dinamicamente -->
                                </select>
                            </div>
                        </div>

                        <!-- Observações -->
                        <div class="form-group">
                            <label for="observacoes" class="required">Observações</label>
                            <textarea id="observacoes" name="observacoes" 
                                      placeholder="N/A; utilizar calculadora; prova em dupla; com consulta..." 
                                      required></textarea>
                        </div>
                    </form>

                    <!-- Botões de Ação -->
                    <div class="form-actions">
                        <button id="btn-limpar" class="btn-limpar">
                            <span class="btn-icon">❌</span>
                            LIMPAR
                        </button>
                        <button id="btn-agendar" class="btn-agendar" disabled>
                            <span class="btn-icon">📨</span>
                            <span id="btn-text">AGENDAR</span>
                            <div id="btn-loader" class="loader" style="display: none;"></div>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="modal-confirmacao" class="modal">
        <div class="modal-content">
            <h3>Agendamento Confirmado!</h3>
            <p>Seu agendamento foi registrado com sucesso.</p>
            <p>Um e-mail de confirmação foi enviado para você.</p>
            <button id="btn-modal-ok" class="btn-ok">OK</button>
        </div>
    </div>

    <script>
    // ✅ CONFIGURAÇÃO DE URLS ABSOLUTAS
    const BASE_URL = 'https://wandersont-silva.github.io/sistema-agendamento-nap';

    // Dados e configurações
    class AgendamentoManager {
        constructor() {
            this.agendamentos = [];
            this.agendamentoSelecionado = null;
            this.horariosPorSegmento = {
                'Fundamental 1': [
                    '07:00', '07:45', '08:30', '09:15', '10:00', '10:45',
                    '13:00', '13:45', '14:30', '15:15', '16:00'
                ],
                'Fundamental 2': [
                    '07:00', '07:45', '08:30', '09:15', '10:00', '10:45', '11:30',
                    '13:00', '13:45', '14:30', '15:15', '16:00', '16:45'
                ],
                'Ensino Médio': [
                    '07:00', '07:45', '08:30', '09:15', '10:00', '10:45', '11:30',
                    '13:00', '13:45', '14:30', '15:15', '16:00', '16:45', '17:30'
                ]
            };
            
            this.turmasPorSegmento = {
                'Fundamental 1': ['1º A', '1º B', '1º C', '1º D', '1º E', '2º A', '2º B', '2º C', '2º D', '2º E', '3º A', '3º B', '3º C', '3º D', '3º E', '4º A', '4º B', '4º C', '4º D', '4º E', '5º A', '5º B', '5º C', '5º D','5º E'],
                'Fundamental 2': ['6º A', '6º B', '6º C', '6º D', '6º E', '7º A', '7º B', '7º C', '7º D', '7º E', '8º A', '8º B', '8º C', '8º D','8º E', '9º A', '9º B', '9º C', '9º D', '9º E'],
                'Ensino Médio': ['1º A', '1º B', '1º C', '1º D', '1º E', '2º A', '2º B', '2º C', '2º D', '2º E', '3º A', '3º B', '3º C', '3º D', '3º E']
            };
            
            this.init();
        }

        init() {
            this.checkAuthentication();
            this.setupEventListeners();
            this.setupMenuNavigation();
            this.carregarAgendamentos();
            this.configurarValidacoes();
        }

        checkAuthentication() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                // ✅ REDIRECIONAMENTO ABSOLUTO
                window.location.href = BASE_URL + '/index.html';
                return;
            }
            this.usuarioLogado = JSON.parse(currentUser);
        }

        setupEventListeners() {
            // Navegação do menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    const menuId = parseInt(item.getAttribute('data-menu'));
                    this.navigateToMenu(menuId);
                });
            });

            // Formulário
            document.getElementById('segmento').addEventListener('change', (e) => {
                this.atualizarTurmas(e.target.value);
                this.atualizarHorarios(e.target.value);
                this.validarFormulario();
            });

            document.getElementById('data').addEventListener('change', (e) => {
                this.validarData(e.target.value);
                this.validarFormulario();
            });

            // Campos do formulário
            const campos = ['disciplina', 'turma', 'hora', 'observacoes'];
            campos.forEach(campo => {
                document.getElementById(campo).addEventListener('change', () => {
                    this.validarFormulario();
                });
            });

            // Botões
            document.getElementById('btn-agendar').addEventListener('click', () => {
                this.submeterAgendamento();
            });

            document.getElementById('btn-limpar').addEventListener('click', () => {
                this.limparFormulario();
            });

            document.getElementById('btn-excluir').addEventListener('click', () => {
                this.excluirAgendamento();
            });

            document.getElementById('btn-modal-ok').addEventListener('click', () => {
                this.fecharModal();
            });
        }

        setupMenuNavigation() {
            // Remove active de todos os itens
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Adiciona active ao item atual
            const currentMenu = document.querySelector('[data-menu="2"]');
            if (currentMenu) {
                currentMenu.classList.add('active');
            }
        }

        navigateToMenu(menuId) {
            // ✅ NAVEGAÇÃO COM URLS ABSOLUTAS
            switch(menuId) {
                case 1: // Dashboard
                    window.location.href = BASE_URL + '/dashboard.html';
                    break;
                case 2: // Agendamento (já estamos aqui)
                    break;
                case 3: // Suporte
                    window.location.href = BASE_URL + '/suporte.html';
                    break;
                case 4: // Calendário
                    window.location.href = BASE_URL + '/calendario.html';
                    break;
                case 5: // Busca
                    window.location.href = BASE_URL + '/busca.html';
                    break;
            }
        }

        // ... (o resto dos métodos permanece igual - são funcionais)
        atualizarTurmas(segmento) {
            const selectTurma = document.getElementById('turma');
            selectTurma.innerHTML = '<option value="">Selecione a turma</option>';
            
            if (segmento && this.turmasPorSegmento[segmento]) {
                this.turmasPorSegmento[segmento].forEach(turma => {
                    const option = document.createElement('option');
                    option.value = turma;
                    option.textContent = turma;
                    selectTurma.appendChild(option);
                });
            }
        }

        atualizarHorarios(segmento) {
            const selectHora = document.getElementById('hora');
            selectHora.innerHTML = '<option value="">Selecione o horário</option>';
            selectHora.disabled = !segmento;
            
            if (segmento && this.horariosPorSegmento[segmento]) {
                this.horariosPorSegmento[segmento].forEach(horario => {
                    const option = document.createElement('option');
                    option.value = horario;
                    option.textContent = horario;
                    selectHora.appendChild(option);
                });
            }
        }

        validarData(data) {
            const dataSelecionada = new Date(data);
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            if (dataSelecionada <= hoje) {
                alert('Não é permitido selecionar a data de hoje ou datas passadas. Por favor, escolha uma data futura.');
                document.getElementById('data').value = '';
                return false;
            }
            return true;
        }

        validarFormulario() {
            const disciplina = document.getElementById('disciplina').value;
            const segmento = document.getElementById('segmento').value;
            const turma = document.getElementById('turma').value;
            const data = document.getElementById('data').value;
            const hora = document.getElementById('hora').value;
            const observacoes = document.getElementById('observacoes').value;
            
            const formValido = disciplina && segmento && turma && data && hora && observacoes;
            
            document.getElementById('btn-agendar').disabled = !formValido;
            
            return formValido;
        }

        carregarAgendamentos() {
            const agendamentosSalvos = localStorage.getItem(`agendamentos_${this.usuarioLogado.email}`);
            this.agendamentos = agendamentosSalvos ? JSON.parse(agendamentosSalvos) : [];
            
            this.renderizarAgendamentos();
        }

        renderizarAgendamentos() {
            const gallery = document.getElementById('gallery-agendamentos');
            gallery.innerHTML = '';

            if (this.agendamentos.length === 0) {
                gallery.innerHTML = '<p class="sem-agendamentos">Nenhum agendamento encontrado</p>';
                return;
            }

            this.agendamentos.forEach((agendamento, index) => {
                const item = document.createElement('div');
                item.className = `agendamento-item ${this.agendamentoSelecionado === index ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="agendamento-disciplina">${agendamento.disciplina}</div>
                    <div class="agendamento-segmento">${agendamento.segmento} - ${agendamento.turma}</div>
                    <div class="agendamento-data">${this.formatarDataHora(agendamento.dataHora)}</div>
                    <div class="agendamento-observacoes">Observações: ${agendamento.observacoes}</div>
                `;
                
                item.addEventListener('click', () => {
                    this.selecionarAgendamento(index);
                });
                
                gallery.appendChild(item);
            });
        }

        selecionarAgendamento(index) {
            this.agendamentoSelecionado = index;
            this.renderizarAgendamentos();
            
            const label = document.getElementById('selected-label');
            const btnExcluir = document.getElementById('btn-excluir');
            
            if (this.agendamentoSelecionado !== null) {
                label.textContent = 'Agendamento selecionado';
                btnExcluir.disabled = false;
            } else {
                label.textContent = 'Nada selecionado';
                btnExcluir.disabled = true;
            }
        }

        async submeterAgendamento() {
            if (!this.validarFormulario()) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            const btnAgendar = document.getElementById('btn-agendar');
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');

            // Mostrar loading
            btnText.textContent = 'ENVIANDO...';
            btnLoader.style.display = 'block';
            btnAgendar.disabled = true;

            try {
                const disponivel = await this.verificarDisponibilidade();
                
                if (!disponivel) {
                    alert('Já existem 2 agendamentos para este período e segmento. Escolha outro horário.');
                    return;
                }

                const novoAgendamento = this.criarAgendamento();
                this.agendamentos.push(novoAgendamento);
                
                this.salvarAgendamentos();
                await this.enviarEmailConfirmacao(novoAgendamento);
                this.mostrarModalConfirmacao();
                this.limparFormulario();
                this.renderizarAgendamentos();
                
            } catch (error) {
                console.error('Erro ao agendar:', error);
                alert('Erro ao realizar agendamento. Tente novamente.');
            } finally {
                btnText.textContent = 'AGENDAR';
                btnLoader.style.display = 'none';
                this.validarFormulario();
            }
        }

        criarAgendamento() {
            const disciplina = document.getElementById('disciplina').value;
            const segmento = document.getElementById('segmento').value;
            const turma = document.getElementById('turma').value;
            const data = document.getElementById('data').value;
            const hora = document.getElementById('hora').value;
            const observacoes = document.getElementById('observacoes').value;

            const [horas, minutos] = hora.split(':');
            const dataHora = new Date(data);
            dataHora.setHours(parseInt(horas), parseInt(minutos), 0, 0);

            return {
                id: this.gerarId(),
                disciplina: disciplina,
                segmento: segmento,
                turma: turma,
                dataHora: dataHora.toISOString(),
                observacoes: observacoes,
                usuario: this.usuarioLogado.email,
                dataCriacao: new Date().toISOString()
            };
        }

        async verificarDisponibilidade() {
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const segmento = document.getElementById('segmento').value;
            const data = document.getElementById('data').value;
            const hora = document.getElementById('hora').value;
            
            const dataHoraSelecionada = new Date(`${data}T${hora}:00`);
            const agendamentosNoMesmoHorario = this.agendamentos.filter(ag => {
                const agDataHora = new Date(ag.dataHora);
                return ag.segmento === segmento && 
                       agDataHora.getTime() === dataHoraSelecionada.getTime();
            });
            
            return agendamentosNoMesmoHorario.length < 2;
        }

        async enviarEmailConfirmacao(agendamento) {
            console.log('Enviando email de confirmação...', agendamento);
            await new Promise(resolve => setTimeout(resolve, 1000));
            console.log('Email enviado com sucesso para:', this.usuarioLogado.email);
            return true;
        }

        excluirAgendamento() {
            if (this.agendamentoSelecionado === null) {
                alert('Nenhum agendamento selecionado para excluir.');
                return;
            }

            if (!confirm('Tem certeza que deseja excluir este agendamento?')) {
                return;
            }

            this.agendamentos.splice(this.agendamentoSelecionado, 1);
            this.agendamentoSelecionado = null;
            
            this.salvarAgendamentos();
            this.renderizarAgendamentos();
            
            const label = document.getElementById('selected-label');
            const btnExcluir = document.getElementById('btn-excluir');
            
            label.textContent = 'Nada selecionado';
            btnExcluir.disabled = true;
            
            alert('Agendamento excluído com sucesso!');
        }

        limparFormulario() {
            document.getElementById('form-agendamento').reset();
            document.getElementById('hora').disabled = true;
            document.getElementById('hora').innerHTML = '<option value="">Selecione o horário</option>';
            document.getElementById('turma').innerHTML = '<option value="">Selecione a turma</option>';
            this.validarFormulario();
        }

        mostrarModalConfirmacao() {
            document.getElementById('modal-confirmacao').style.display = 'flex';
        }

        fecharModal() {
            document.getElementById('modal-confirmacao').style.display = 'none';
        }

        salvarAgendamentos() {
            localStorage.setItem(`agendamentos_${this.usuarioLogado.email}`, JSON.stringify(this.agendamentos));
        }

        gerarId() {
            return 'agendamento_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        formatarDataHora(dataHoraISO) {
            const data = new Date(dataHoraISO);
            return data.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        configurarValidacoes() {
            const amanha = new Date();
            amanha.setDate(amanha.getDate() + 1);
            const dataInput = document.getElementById('data');
            dataInput.min = amanha.toISOString().split('T')[0];
        }
    }

    // Inicializar quando a página carregar
    document.addEventListener('DOMContentLoaded', () => {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
            window.location.href = BASE_URL + '/index.html';
            return;
        }
        new AgendamentoManager();
    });
</script>
</body>
</html>

